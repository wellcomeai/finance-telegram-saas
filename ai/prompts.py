"""
AI Prompts for different tasks
"""

from typing import Dict
from datetime import datetime


class AIPrompts:
    """Промпты для различных задач AI"""
    
    @staticmethod
    def text_parser_prompt(text: str) -> str:
        """
        Промпт для парсинга текста транзакции
        """
        current_date = datetime.now().strftime("%Y-%m-%d")
        
        return f"""Ты финансовый ассистент. Твоя задача - извлечь информацию о транзакции из текста пользователя.

ТЕКСТ ПОЛЬЗОВАТЕЛЯ: "{text}"

ТЕКУЩАЯ ДАТА: {current_date}

ИНСТРУКЦИИ:
1. Определи тип транзакции: "income" (доход) или "expense" (расход)
2. Извлеки сумму в рублях (только число)
3. Определи категорию из списка ниже
4. Создай краткое описание (не более 100 символов)
5. Определи дату (если не указана - используй текущую)

КАТЕГОРИИ РАСХОДОВ:
- Продукты (еда, продукты питания, магазин, супермаркет)
- Рестораны и кафе (ресторан, кафе, кофе, обед, ужин)
- Транспорт (такси, метро, автобус, проезд, транспорт)
- Топливо (бензин, заправка, газ, АЗС)
- Жилье (аренда, коммуналка, квартплата, ЖКХ, электричество, вода)
- Покупки (одежда, обувь, техника, электроника, мебель)
- Здоровье и аптека (аптека, лекарства, врач, больница, медицина)
- Образование (курсы, книги, обучение, учеба)
- Развлечения (кино, игры, концерт, театр, хобби)
- Связь и интернет (мобильная связь, интернет, телефон)
- Спорт и фитнес (спортзал, фитнес, тренажерка, йога)
- Путешествия (отель, авиабилеты, путевка, отпуск)
- Подарки (подарок, сувенир)
- Красота и уход (парикмахер, салон, косметика, маникюр)
- Прочее (если не подходит ни одна категория)

КАТЕГОРИИ ДОХОДОВ:
- Зарплата (зарплата, оклад, ЗП)
- Фриланс/Подработка (фриланс, подработка, проект, заказ)
- Подарки/Возвраты (подарок, возврат, вернули)
- Инвестиции (дивиденды, проценты, инвестиции, акции)
- Другие доходы (прочий доход)

ФОРМАТ ОТВЕТА (СТРОГО JSON):
{{
    "type": "income" или "expense",
    "amount": число,
    "category_name": "название категории",
    "description": "краткое описание",
    "date": "YYYY-MM-DD"
}}

ПРИМЕРЫ:
Вход: "Потратил 500 на такси"
Ответ: {{"type": "expense", "amount": 500, "category_name": "Транспорт", "description": "Такси", "date": "{current_date}"}}

Вход: "Купил продукты за 2500"
Ответ: {{"type": "expense", "amount": 2500, "category_name": "Продукты", "description": "Покупка продуктов", "date": "{current_date}"}}

Вход: "Получил зарплату 50000"
Ответ: {{"type": "income", "amount": 50000, "category_name": "Зарплата", "description": "Зарплата", "date": "{current_date}"}}

ВАЖНО:
- Отвечай ТОЛЬКО JSON без дополнительного текста
- Если не можешь определить - верни null
- Суммы всегда положительные числа
- Дата в формате YYYY-MM-DD
"""

    @staticmethod
    def categorizer_prompt(description: str, amount: float, transaction_type: str) -> str:
        """
        Промпт для определения категории транзакции
        """
        categories = """
КАТЕГОРИИ РАСХОДОВ:
- Продукты
- Рестораны и кафе
- Транспорт
- Топливо
- Жилье
- Покупки
- Здоровье и аптека
- Образование
- Развлечения
- Связь и интернет
- Спорт и фитнес
- Путешествия
- Подарки
- Красота и уход
- Прочее

КАТЕГОРИИ ДОХОДОВ:
- Зарплата
- Фриланс/Подработка
- Подарки/Возвраты
- Инвестиции
- Другие доходы
"""
        
        return f"""Определи категорию для транзакции.

ТИП: {transaction_type}
СУММА: {amount} ₽
ОПИСАНИЕ: "{description}"

{categories}

Ответь ТОЛЬКО названием категории из списка выше. Без дополнительного текста."""

    @staticmethod
    def image_ocr_prompt() -> str:
        """
        Промпт для распознавания чека на фото
        """
        return """Ты обрабатываешь фото чека. Извлеки следующую информацию:

1. Общая сумма чека
2. Дата покупки
3. Название магазина/организации
4. Основные товары/услуги (топ-5 самых дорогих или важных)

ФОРМАТ ОТВЕТА (СТРОГО JSON):
{
    "amount": число (общая сумма),
    "date": "YYYY-MM-DD",
    "merchant": "название магазина",
    "items": ["товар 1", "товар 2", "товар 3"]
}

ВАЖНО:
- Если какое-то поле не удалось распознать - используй null
- Сумма всегда положительное число
- Дата в формате YYYY-MM-DD
- Отвечай ТОЛЬКО JSON"""

    @staticmethod
    def pdf_parser_prompt() -> str:
        """
        Промпт для парсинга PDF чека
        """
        return """Ты обрабатываешь PDF чек. Извлеки следующую информацию:

1. Общая сумма
2. Дата транзакции
3. Название организации/магазина
4. Описание покупки или список основных товаров

ФОРМАТ ОТВЕТА (СТРОГО JSON):
{
    "amount": число,
    "date": "YYYY-MM-DD",
    "merchant": "название",
    "description": "описание покупки"
}

ВАЖНО:
- Отвечай ТОЛЬКО JSON
- Если поле не найдено - используй null
- Сумма положительное число"""

    @staticmethod
    def voice_context_prompt() -> str:
        """
        Системный промпт для обработки транскрибированного голоса
        """
        return """После транскрипции голосового сообщения обработай текст как обычную текстовую транзакцию.
Пользователь может говорить неформально, с паузами, ошибками - извлеки суть."""


# Экспортируем единственный экземпляр
prompts = AIPrompts()
